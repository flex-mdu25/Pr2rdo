<!DOCTYPE html>
<html>
<head>
    <title>Web App Form</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-4">
    <div class="accordion" id="formAccordion">
        <!-- สร้างฟอร์ม 4 กลุ่ม -->
        <div class="card">
            <div class="card-header" id="headingOne">
                <h2 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne">
                        กลุ่มที่ 1
                    </button>
                </h2>
            </div>
            <div id="collapseOne" class="collapse show" data-parent="#formAccordion">
                <div class="card-body">
                    <form id="form1">
                        <label>รายละเอียด:</label>
                        <input type="text" name="details1" class="form-control" required>
                        <label>อัพโหลดรูปภาพ (4 รูป):</label>
                        <input type="file" name="images1" class="form-control" multiple required>
                    </form>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header" id="headingTwo">
                <h2 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseTwo">
                        กลุ่มที่ 2
                    </button>
                </h2>
            </div>
            <div id="collapseTwo" class="collapse" data-parent="#formAccordion">
                <div class="card-body">
                    <form id="form2">
                        <label>รายละเอียด:</label>
                        <input type="text" name="details2" class="form-control" required>
                        <label>อัพโหลดรูปภาพ (4 รูป):</label>
                        <input type="file" name="images2" class="form-control" multiple required>
                    </form>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header" id="headingThree">
                <h2 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseThree">
                        กลุ่มที่ 3
                    </button>
                </h2>
            </div>
            <div id="collapseThree" class="collapse" data-parent="#formAccordion">
                <div class="card-body">
                    <form id="form3">
                        <label>รายละเอียด:</label>
                        <input type="text" name="details3" class="form-control" required>
                        <label>อัพโหลดรูปภาพ (4 รูป):</label>
                        <input type="file" name="images3" class="form-control" multiple required>
                    </form>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header" id="headingFour">
                <h2 class="mb-0">
                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseFour">
                        กลุ่มที่ 4
                    </button>
                </h2>
            </div>
            <div id="collapseFour" class="collapse" data-parent="#formAccordion">
                <div class="card-body">
                    <form id="form4">
                        <label>รายละเอียด:</label>
                        <input type="text" name="details4" class="form-control" required>
                        <label>อัพโหลดรูปภาพ (4 รูป):</label>
                        <input type="file" name="images4" class="form-control" multiple required>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <button type="button" onclick="submitAllForms()" class="btn btn-success mt-3">บันทึกทั้งหมด</button>
    <div id="loadingSpinner" class="text-center mt-3" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">กำลังบันทึก...</span>
        </div>
        <p>กำลังบันทึกข้อมูล...</p>
    </div>
</div>
<script>
function submitAllForms() {
    document.getElementById('loadingSpinner').style.display = 'block';

    let formData = new FormData();
    
    for (let i = 1; i <= 4; i++) {
        let form = document.getElementById('form' + i);
        let details = form.querySelector('input[name="details' + i + '"]').value;
        let images = form.querySelector('input[name="images' + i + '"]').files;

        formData.append('details' + i, details);

        for (let j = 0; j < images.length; j++) {
            let reader = new FileReader();
            reader.onload = function(event) {
                let base64String = event.target.result.split(',')[1]; 
                formData.append('images[]', base64String);
            };
            reader.readAsDataURL(images[j]);
        }
    }

    setTimeout(() => {
        fetch('https://script.google.com/macros/s/AKfycbyDVWmFOnoCXP2tysUpKdEiLGuuSWOeEb4zHEHqOEtxv_9YSRM3dAOQ6odOg0J14qCc/exec', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('loadingSpinner').style.display = 'none';
            Swal.fire('สำเร็จ!', 'บันทึกข้อมูลเรียบร้อย', 'success');
        })
        .catch(error => {
            document.getElementById('loadingSpinner').style.display = 'none';
            Swal.fire('เกิดข้อผิดพลาด!', error.message, 'error');
        });
    }, 2000);
}
</script>

</body>
</html>
