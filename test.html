<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="https://image.makewebeasy.net/makeweb/0/pMrtkmxgt/APNG_images/bot_02.png?v=202012190947" rel="shortcut icon" />

    <!-- Sweet Alert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />

    <title>Share Flex Message จ้ะ</title>
  </head>
  <body>
    <center>กำลังโหลด...</center>
    <center>
      <img src="https://image.makewebeasy.net/makeweb/0/pMrtkmxgt/APNG_images/loader1_1.gif?v=202012190947" alt="loading" width="126" height="129" />
      <br />กรุณารอสักครู่
    </center>

    <!-- LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <script>
      window.onload = function () {
        if (typeof liff === "undefined") {
          console.error("LIFF SDK is not loaded.");
          return;
        }

        liff.init({ liffId: "2006828731-6WBlj9gQ" })
          .then(() => {
            console.log("LIFF Init Success");
            if (liff.isLoggedIn()) {
              dolink();
            } else {
              liff.login();
            }
          })
          .catch((error) => console.error("LIFF Initialization Failed:", error));

        function getParameterByName(name) {
          const url = new URL(window.location.href);
          return url.searchParams.get(name);
        }

        function dolink() {
          const refer = getParameterByName("refer");
          console.log("Received refer:", refer);

          if (!refer) {
            console.error("Refer parameter is missing.");
            return;
          }

          if (refer === "ex0") {
            liff.sendMessages([{ type: "text", text: "Hello สวัสดีจร้า" }])
              .then(() => {
                console.log("Message sent successfully");
                liff.closeWindow();
              })
              .catch((error) => console.error("Error sending message:", error));
          }

          if (refer === "sharepr1") {
            liff.shareTargetPicker([
              {
                type: "flex",
                altText: "โปรโมชั่นพิเศษ!",
                contents: {
                  type: "carousel",
                  contents: [
                    {
                      type: "bubble",
                      hero: {
                        type: "image",
                        url: "https://developers-resource.landpress.line.me/fx/clip/clip1.jpg",
                        size: "full",
                        aspectRatio: "2:3",
                        aspectMode: "cover",
                      },
                      body: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                          {
                            type: "text",
                            text: "Brown's T-shirts",
                            weight: "bold",
                            size: "xl",
                          },
                          {
                            type: "text",
                            text: "¥35,800",
                            color: "#999999",
                            size: "md",
                            decoration: "line-through",
                          },
                          {
                            type: "text",
                            text: "¥75,000",
                            weight: "bold",
                            size: "lg",
                          },
                        ],
                      },
                    },
                    {
                      type: "bubble",
                      hero: {
                        type: "image",
                        url: "https://developers-resource.landpress.line.me/fx/clip/clip2.jpg",
                        size: "full",
                        aspectRatio: "2:3",
                        aspectMode: "cover",
                      },
                      body: {
                        type: "box",
                        layout: "vertical",
                        contents: [
                          {
                            type: "text",
                            text: "Cony's T-shirts",
                            weight: "bold",
                            size: "xl",
                          },
                          {
                            type: "text",
                            text: "¥35,800",
                            color: "#999999",
                            size: "md",
                            decoration: "line-through",
                          },
                          {
                            type: "text",
                            text: "¥75,000",
                            weight: "bold",
                            size: "lg",
                          },
                        ],
                      },
                    },
                  ],
                },
              },
            ])
              .then(() => {
                Swal.fire({
                  position: "top-center",
                  icon: "success",
                  title: "ส่ง เรียบร้อย",
                  showConfirmButton: false,
                  timer: 1500,
                }).then(() => liff.closeWindow());
              })
              .catch((error) => console.error("Error sharing Flex Message:", error));
          }
        }
      };
    </script>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
